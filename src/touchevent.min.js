/*
   pm.build.js ,version 1.2.1 ,updated on 2016-03-07
   module for Plugins Modules library.

   https://github.com/donghanji/pm
 */

!function(a){function b(c,d,e){c!==a&&null!==c&&(c[b.expando]=c[b.expando]||b.gid++,b.regist(c,d,e))}if(module.declare===a)throw"There is no global module.declare method!";module.alias({"zepto.module":"{modules}/zepto.module",os:"{plugins}/os"}),module.globals({$:"zepto.module"}),module.defaults("touchevent",{pressTime:1e3,delayTime:0,offsetTime:200,rotateAngle:5,scale:.2,eventListenerZone:document}),b.regist=function(a,c,d){if("function"==typeof d){var e=a[b.expando];b.Event[e]=b.Event[e]||{},b.Event[e][c]=b.Event[e][c]||[],b.Event[e][c].push(d)}},b.remove=function(c,d,e){var f=c[b.expando],g=b.get(c,d,e);if(g&&c){if(e===a)return b.Event[f]&&b.Event[f][d]&&delete b.Event[f][d],void g.forEach(function(a,b){c.removeEventListener(d,a,!1)});var h=g.index;b.Event[f][d].splice(h,1),c.removeEventListener(d,e,!1)}},b.get=function(c,d,e){var f=c[b.expando];if(f!==a&&null!==f&&b.Event[f]&&b.Event[f][d]){if(e===a)return b.Event[f][d];for(var g=0,h=b.Event[f][d].length;h>g;g++)if(b.Event[f][d][g]===e)return{index:g,fn:e}}},b.dispatch=function(a,c,d){var e=b.get(a,c);e&&e.forEach(function(b,c){b.call(a,d)})},b.isIn=function(a){var c=a[b.expando];return b.Event[c]?!0:!1},b.Event={},b.expando="_TouchEvent"+(""+Math.random()).replace(/\D/g,""),b.gid=1;var c=module.globals(),d=c.$;module.declare("touchevent",[d,"os"],function(c,e){function f(c){c.fn.eventAccess=function(a,b,c,d){for(var e=0,f=a.length;f>e;e++)b.call(a[e],c,d);return this},c.each(t,function(d,e){c.each(n[d],function(d,f){c.fn[e+f]=function(c,d,g){return g=g===a?!0:g,d=d===!0?!0:!1,this.eventAccess(this,function(a,c){if(null==c)return void this.dispatchEvent(this.event[a]);var f=this;document.createEvent(r[e]);f.bubbles=d,f.addEventListener(a,c,d),new b(f,a,c)},e+f,c)}})}),c.each(t,function(a,d){c.fn["unbind"+d]=function(a,c){return this.eventAccess(this,function(a,c){!function(a,d){var e=setTimeout(function(){clearTimeout(e),b.remove(a,d,c)})}(this,d+a)},a,c)}})}function g(a){"string"==typeof a&&(a=document.getElementById(a)),a.addEventListener(u,this,!0),a.addEventListener(x,this,!0)}function h(a,b){var c=a.target,d=a.touches&&a.touches[0]||a,e=b.delta;if("INPUT"===c.tagName)return a.preventDefault();if("TEXTAREA"===c.tagName){var f=c.scrollTop<=0,g=c.scrollTop+c.clientHeight>=c.scrollHeight,h=(d.layerY||d.pageY)>e.startY,i=(d.layerY||d.pageY)<e.startY;f&&h||g&&i?a.preventDefault():a.stopPropagation()}}var i=c("os"),j=c(d),k=module.defaults("touchevent"),l=["down","up","on","press","move"],m=["down","up","move","rotate","scale"],n=[l,m],o=i.desktop,p="touch",q="gesture",r={},s=k.eventListenerZone||document;r[p]=o?"HTMLEvents":"TouchEvent",r[q]=o?"HTMLEvents":"GestureEvent";var t=[p,q],u=o?"mousedown":"touchstart",v=o?"mousemove":"touchmove",w=o?"mouseup":"touchend",x=o?"mousedown":"gesturestart",y=o?"mousemove":"gesturechange",z=o?"mouseup":"gestureend";g.prototype={dx:0,dy:0,cx:0,cy:0,isInPressTime:!0,isInDelayTime:!0,triggered:!1,moved:!1,pressTimeout:null,delayTimeout:null,handleEvent:function(a){var c=a.target;if(!o||0==a.button){3===c.nodeType&&(c=c.parentNode),this.triggered=!1,this.isInPressTime=!0;var d=this;if(null===this.delayTimeout){var e=k.delayTime;e-=k.offsetTime,e=e>0?e:0,d.delayTimeout=setTimeout(function(){d.isInDelayTime=!0,clearTimeout(d.delayTimeout),d.delayTimeout=null},e)}for(;9!==c.nodeType;){if(b.isIn(c)&&(this[a.type].call(this,a,c),c.bubbles))return;c=c&&c.parentNode?c.parentNode:document}}},mousedown:function(a,b){this.touchstart(a,b)},mousemove:function(a,b){h(a,b),this.touchmove(a,b)},mouseup:function(a,b){this.touchend(a,b)},touchstart:function(a,c){var d=a.touches&&a.touches[0]||a;c.delta={startX:d.layerX||d.pageX,startY:d.layerY||d.pageY,endX:d.layerX||d.pageX,endY:d.layerY||d.pageY,moveX:0,moveY:0};var e=p+"down",f=this;if(this.moved=!1,b.dispatch(c,e,a),null===this.pressTimeout){var g=k.pressTime;g-=k.offsetTime,g=g>0?g:0,f.pressTimeout=setTimeout(function(){if(f.isInPressTime=!f.isInPressTime,!f.isInPressTime&&!f.moved){var d=p+"press";b.dispatch(c,d,a)}clearTimeout(f.pressTimeout),f.pressTimeout=null},g)}document.addEventListener(v,this,!0),document.addEventListener(w,this,!0),document.removeEventListener(u,this,!1)},touchmove:function(a,c){h(a,c);var d=a.touches&&a.touches[0]||a;c.delta=c.delta||{},c.delta.endX=d.layerX||d.pageX,c.delta.endY=d.layerY||d.pageY,c.delta.moveX=c.delta.endX-c.delta.startX,c.delta.moveY=c.delta.endY-c.delta.startY,this.moved=!0,!o||0!==c.delta.moveX&&0!==c.delta.moveY||(this.moved=!1),this.isInPressTime=!0;var e=p+"move";b.dispatch(c,e,a)},touchend:function(a,c){document.removeEventListener(v,this,!0),document.removeEventListener(w,this,!0);var d=p+"up";if(b.dispatch(c,d,a),this.isInPressTime&&this.isInDelayTime&&!this.moved){var e=p+"on";this.prevTarget=c,b.dispatch(c,e,a)}clearTimeout(this.pressTimeout),this.pressTimeout=null,this.triggered=!0},gesturestart:function(a,c){var d=a.touches&&a.touches[0]||a;c.delta={startX:d.layerX||d.pageX,startY:d.layerY||d.pageY,endX:d.layerX||d.pageX,endY:d.layerY||d.pageY,moveX:0,moveY:0};var e=q+"down";b.dispatch(c,e,a),document.addEventListener(y,this,!0),document.addEventListener(z,this,!0),document.removeEventListener(x,this,!1)},gesturechange:function(a,c){var d=a.touches&&a.touches[0]||a;c.delta=c.delta||{},c.delta.endX=d.layerX||d.pageX,c.delta.endY=d.layerY||d.pageY,c.delta.moveX=d.layerX-c.delta.startX,c.delta.moveY=d.layerY-c.delta.startY;var e=q+"move";b.dispatch(c,e,a);var f=q+"rotate";c.rotation=a.rotation||0,b.dispatch(c,f,a);var g=q+"scale";c.scale=a.scale||1,b.dispatch(c,g,a)},gestureend:function(a,c){document.removeEventListener(y,this,!1),document.removeEventListener(z,this,!1);var d=q+"up";c.delta.endX=a.layerX,c.delta.endY=a.layerY,c.delta.moveX=a.layerX-c.delta.startX,c.delta.moveY=a.layerY-c.delta.startY,b.dispatch(c,d,a)}},f(j),new g(s)})}();